<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anivers√°rio no McDonald's! üçü</title>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="card">
        <h1>Festa do Heitor!</h1>
        <div class="convite-para">üçî Vamos celebrar no McDonald's! üçü</div>
        
        <div class="detalhes-festa">
            <p><span class="icon">üìÖ</span> Data: <strong> 28 de Mar√ßo</strong></p>
            <p><span class="icon">‚è∞</span> Hor√°rio: <strong> √†s 15h00</strong></p>
            <p><span class="icon">üìç</span> Local: <strong> McDonald's Santo Tirso</strong></p>
            <p style="font-size: 0.8rem; margin-left: 32px; color: #666;">R. dos Trabalhadores do Arco, 4780-424</p>
        </div>

        <form id="inviteForm">
            <input type="text" id="crianca" placeholder="Nome da Crian√ßa" required>
            <input type="text" id="responsavel" placeholder="Nome do Respons√°vel" required>
            <input type="tel" id="telefone" placeholder="Telem√≥vel / WhatsApp" required>
            
            <button type="submit" id="btnSubmit">Confirmar Presen√ßa</button>
        </form>
    </div>

    <script>
        // --- AUTOMA√á√ÉO DO WHATSAPP NO LINK ---
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const telDoLink = urlParams.get('tel'); // Procura por ?tel=... no link
            if (telDoLink) {
                document.getElementById('telefone').value = telDoLink;
            }
        };

        const form = document.getElementById('inviteForm');
        form.onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnSubmit');
            btn.innerText = "Confirmando... ‚è≥";
            btn.disabled = true;

            const dados = {
                Crianca: document.getElementById('crianca').value,
                Responsavel: document.getElementById('responsavel').value,
                Telefone: document.getElementById('telefone').value,
                Confirmado: "Sim",
                Data: new Date().toLocaleString('pt-PT')
            };

            try {
                const response = await fetch('/confirmar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                });
                
                if (response.ok) {
                    alert('Oba! Presen√ßa confirmada. üéâ');
                    form.reset();
                } else {
                    alert('Houve um erro. Tente novamente!');
                }
            } catch (error) {
                alert('Erro de conex√£o.');
            } finally {
                btn.innerText = "Confirmar Presen√ßa";
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>